{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport * as Notifications from 'expo-notifications';\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nvar SCHEDULED_IDS_KEY = 'SCHEDULED_ADHAN_IDS';\nexport function ensureNotificationChannel() {\n  return _ensureNotificationChannel.apply(this, arguments);\n}\nfunction _ensureNotificationChannel() {\n  _ensureNotificationChannel = _asyncToGenerator(function* () {\n    if (Platform.OS === 'android') {\n      yield Notifications.setNotificationChannelAsync('adhan-channel', {\n        name: 'Adhan',\n        importance: Notifications.AndroidImportance.MAX,\n        sound: 'default',\n        vibrationPattern: [0, 250, 250, 250]\n      });\n    }\n  });\n  return _ensureNotificationChannel.apply(this, arguments);\n}\nexport function requestPermissions() {\n  return _requestPermissions.apply(this, arguments);\n}\nfunction _requestPermissions() {\n  _requestPermissions = _asyncToGenerator(function* () {\n    var _yield$Notifications$ = yield Notifications.requestPermissionsAsync(),\n      status = _yield$Notifications$.status;\n    return status === 'granted' || status === 'provisional';\n  });\n  return _requestPermissions.apply(this, arguments);\n}\nexport function scheduleNotificationForPrayer(_x, _x2, _x3, _x4, _x5) {\n  return _scheduleNotificationForPrayer.apply(this, arguments);\n}\nfunction _scheduleNotificationForPrayer() {\n  _scheduleNotificationForPrayer = _asyncToGenerator(function* (idTag, title, body, date, voicePath) {\n    var trigger = {\n      date: date\n    };\n    var id = yield Notifications.scheduleNotificationAsync({\n      content: {\n        title: title,\n        body: body,\n        sound: 'default',\n        data: {\n          idTag: idTag,\n          voicePath: voicePath\n        }\n      },\n      trigger: trigger\n    });\n    try {\n      var raw = yield AsyncStorage.getItem(SCHEDULED_IDS_KEY);\n      var arr = raw ? JSON.parse(raw) : [];\n      arr.push(id);\n      yield AsyncStorage.setItem(SCHEDULED_IDS_KEY, JSON.stringify(arr));\n    } catch (e) {}\n    return id;\n  });\n  return _scheduleNotificationForPrayer.apply(this, arguments);\n}\nexport function cancelAllScheduledNotifications() {\n  return _cancelAllScheduledNotifications.apply(this, arguments);\n}\nfunction _cancelAllScheduledNotifications() {\n  _cancelAllScheduledNotifications = _asyncToGenerator(function* () {\n    try {\n      var raw = yield AsyncStorage.getItem(SCHEDULED_IDS_KEY);\n      var arr = raw ? JSON.parse(raw) : [];\n      yield Promise.all(arr.map(function (id) {\n        return Notifications.cancelScheduledNotificationAsync(id);\n      }));\n      yield AsyncStorage.removeItem(SCHEDULED_IDS_KEY);\n    } catch (e) {}\n  });\n  return _cancelAllScheduledNotifications.apply(this, arguments);\n}\nexport function scheduleDailyPrayerNotifications(_x6, _x7) {\n  return _scheduleDailyPrayerNotifications.apply(this, arguments);\n}\nfunction _scheduleDailyPrayerNotifications() {\n  _scheduleDailyPrayerNotifications = _asyncToGenerator(function* (prayerTimesMap, voicePath) {\n    yield cancelAllScheduledNotifications();\n    yield ensureNotificationChannel();\n    var entries = Object.entries(prayerTimesMap);\n    var scheduled = [];\n    for (var _ref of entries) {\n      var _ref2 = _slicedToArray(_ref, 2);\n      var name = _ref2[0];\n      var dt = _ref2[1];\n      var now = new Date();\n      var scheduledDate = new Date(dt);\n      if (scheduledDate <= now) {\n        scheduledDate.setDate(scheduledDate.getDate() + 1);\n      }\n      var id = yield scheduleNotificationForPrayer(name + \"-\" + scheduledDate.toISOString().slice(0, 10), name + \" prayer time\", \"It's time for \" + name + \" prayer\", scheduledDate, voicePath);\n      scheduled.push(id);\n    }\n    return scheduled;\n  });\n  return _scheduleDailyPrayerNotifications.apply(this, arguments);\n}\nexport function scheduleTestNotification() {\n  return _scheduleTestNotification.apply(this, arguments);\n}\nfunction _scheduleTestNotification() {\n  _scheduleTestNotification = _asyncToGenerator(function* () {\n    var minutesFromNow = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n    var voicePath = arguments.length > 1 ? arguments[1] : undefined;\n    yield ensureNotificationChannel();\n    var date = new Date();\n    date.setMinutes(date.getMinutes() + minutesFromNow);\n    var id = yield scheduleNotificationForPrayer(\"test-\" + date.toISOString(), 'Test Adhan', 'This notification will play the active adhan voice when received.', date, voicePath);\n    return {\n      id: id,\n      date: date\n    };\n  });\n  return _scheduleTestNotification.apply(this, arguments);\n}\nexport function presentTestNotification(_x8) {\n  return _presentTestNotification.apply(this, arguments);\n}\nfunction _presentTestNotification() {\n  _presentTestNotification = _asyncToGenerator(function* (voicePath) {\n    yield ensureNotificationChannel();\n    try {\n      var id = yield Notifications.presentNotificationAsync({\n        title: 'Test Adhan',\n        body: 'This notification will play the active adhan voice when received.',\n        data: {\n          voicePath: voicePath\n        }\n      });\n      return id;\n    } catch (e) {\n      console.warn('presentTestNotification failed', e);\n      throw e;\n    }\n  });\n  return _presentTestNotification.apply(this, arguments);\n}","map":{"version":3,"names":["Notifications","Platform","AsyncStorage","SCHEDULED_IDS_KEY","ensureNotificationChannel","_ensureNotificationChannel","apply","arguments","_asyncToGenerator","OS","setNotificationChannelAsync","name","importance","AndroidImportance","MAX","sound","vibrationPattern","requestPermissions","_requestPermissions","_yield$Notifications$","requestPermissionsAsync","status","scheduleNotificationForPrayer","_x","_x2","_x3","_x4","_x5","_scheduleNotificationForPrayer","idTag","title","body","date","voicePath","trigger","id","scheduleNotificationAsync","content","data","raw","getItem","arr","JSON","parse","push","setItem","stringify","e","cancelAllScheduledNotifications","_cancelAllScheduledNotifications","Promise","all","map","cancelScheduledNotificationAsync","removeItem","scheduleDailyPrayerNotifications","_x6","_x7","_scheduleDailyPrayerNotifications","prayerTimesMap","entries","Object","scheduled","_ref","_ref2","_slicedToArray","dt","now","Date","scheduledDate","setDate","getDate","toISOString","slice","scheduleTestNotification","_scheduleTestNotification","minutesFromNow","length","undefined","setMinutes","getMinutes","presentTestNotification","_x8","_presentTestNotification","presentNotificationAsync","console","warn"],"sources":["G:/Adhan_new/src/services/notifications.ts"],"sourcesContent":["import * as Notifications from 'expo-notifications';\r\nimport { Platform } from 'react-native';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nconst SCHEDULED_IDS_KEY = 'SCHEDULED_ADHAN_IDS';\r\n\r\nexport async function ensureNotificationChannel() {\r\n  if (Platform.OS === 'android') {\r\n    await Notifications.setNotificationChannelAsync('adhan-channel', {\r\n      name: 'Adhan',\r\n      importance: Notifications.AndroidImportance.MAX,\r\n      sound: 'default',\r\n      vibrationPattern: [0, 250, 250, 250],\r\n    });\r\n  }\r\n}\r\n\r\nexport async function requestPermissions() {\r\n  const { status } = await Notifications.requestPermissionsAsync();\r\n  return status === 'granted' || status === 'provisional';\r\n}\r\n\r\nexport async function scheduleNotificationForPrayer(\r\n  idTag: string,\r\n  title: string,\r\n  body: string,\r\n  date: Date,\r\n  voicePath?: string\r\n) {\r\n  const trigger = { date } as any;\r\n\r\n  const id = await Notifications.scheduleNotificationAsync({\r\n    content: {\r\n      title,\r\n      body,\r\n      sound: 'default',\r\n      data: { idTag, voicePath },\r\n    },\r\n    trigger,\r\n  });\r\n\r\n  // persist scheduled id\r\n  try {\r\n    const raw = await AsyncStorage.getItem(SCHEDULED_IDS_KEY);\r\n    const arr: string[] = raw ? JSON.parse(raw) : [];\r\n    arr.push(id);\r\n    await AsyncStorage.setItem(SCHEDULED_IDS_KEY, JSON.stringify(arr));\r\n  } catch (e) {\r\n    // ignore persistence errors\r\n  }\r\n\r\n  return id;\r\n}\r\n\r\nexport async function cancelAllScheduledNotifications() {\r\n  try {\r\n    const raw = await AsyncStorage.getItem(SCHEDULED_IDS_KEY);\r\n    const arr: string[] = raw ? JSON.parse(raw) : [];\r\n    await Promise.all(arr.map((id) => Notifications.cancelScheduledNotificationAsync(id)));\r\n    await AsyncStorage.removeItem(SCHEDULED_IDS_KEY);\r\n  } catch (e) {\r\n    // ignore\r\n  }\r\n}\r\n\r\nexport async function scheduleDailyPrayerNotifications(prayerTimesMap: { [k: string]: Date }, voicePath?: string) {\r\n  await cancelAllScheduledNotifications();\r\n  await ensureNotificationChannel();\r\n\r\n  const entries = Object.entries(prayerTimesMap);\r\n\r\n  const scheduled = [] as string[];\r\n\r\n  for (const [name, dt] of entries) {\r\n    // If time is in the past for today, schedule for tomorrow\r\n    const now = new Date();\r\n    let scheduledDate = new Date(dt);\r\n    if (scheduledDate <= now) {\r\n      scheduledDate.setDate(scheduledDate.getDate() + 1);\r\n    }\r\n\r\n    const id = await scheduleNotificationForPrayer(\r\n      `${name}-${scheduledDate.toISOString().slice(0, 10)}`,\r\n      `${name} prayer time`,\r\n      `It's time for ${name} prayer`,\r\n      scheduledDate,\r\n      voicePath\r\n    );\r\n    scheduled.push(id);\r\n  }\r\n\r\n  return scheduled;\r\n}\r\n\r\nexport async function scheduleTestNotification(minutesFromNow = 1, voicePath?: string) {\r\n  await ensureNotificationChannel();\r\n  const date = new Date();\r\n  date.setMinutes(date.getMinutes() + minutesFromNow);\r\n  const id = await scheduleNotificationForPrayer(\r\n    `test-${date.toISOString()}`,\r\n    'Test Adhan',\r\n    'This notification will play the active adhan voice when received.',\r\n    date,\r\n    voicePath\r\n  );\r\n\r\n  // return the scheduled id and date for UI\r\n  return { id, date };\r\n}\r\n\r\nexport async function presentTestNotification(voicePath?: string) {\r\n  await ensureNotificationChannel();\r\n  try {\r\n    const id = await Notifications.presentNotificationAsync({\r\n      title: 'Test Adhan',\r\n      body: 'This notification will play the active adhan voice when received.',\r\n      data: { voicePath },\r\n    });\r\n    return id;\r\n  } catch (e) {\r\n    console.warn('presentTestNotification failed', e);\r\n    throw e;\r\n  }\r\n} \r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}